{
  "type": "Root",
  "block": {
    "type": "Block",
    "statements": [
      {
        "type": "Step",
        "id": "init",
        "desc": "Init",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Var",
              "variable": "retryCounter",
              "expression": {
                "type": "Literal",
                "value": 0
              }
            },
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Init complete"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_0"
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "failExample",
        "desc": "Basic fail (demo)",
        "onError": "continue",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Fail example start"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_1"
            },
            {
              "type": "Action",
              "module": "math",
              "args": {
                "__options": [
                  "add"
                ],
                "op": "add",
                "a": "missingVar",
                "b": 1
              },
              "output": "broken"
            },
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "This line never runs"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_2"
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "continueExample",
        "desc": "Continue policy",
        "onError": "continue",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Continue example start"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_3"
            },
            {
              "type": "Action",
              "module": "math",
              "args": {
                "__options": [
                  "add"
                ],
                "op": "add",
                "a": "missingVar",
                "b": 1
              },
              "output": "broken"
            },
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Continue example end"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_4"
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "retryExample",
        "desc": "Retry policy",
        "onError": "retry=2",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Retry example, current counter ="
                    }
                  },
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Identifier",
                      "name": "retryCounter"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_5"
            },
            {
              "type": "If",
              "condition": {
                "type": "Simple",
                "left": {
                  "type": "Identifier",
                  "name": "retryCounter"
                },
                "comparator": "<",
                "right": {
                  "type": "Literal",
                  "value": 1
                },
                "negated": false
              },
              "thenBlock": {
                "type": "Block",
                "statements": [
                  {
                    "type": "Set",
                    "target": "retryCounter",
                    "expression": {
                      "type": "BinaryExpression",
                      "operator": "+",
                      "left": {
                        "type": "Identifier",
                        "name": "retryCounter"
                      },
                      "right": {
                        "type": "Literal",
                        "value": 1
                      }
                    }
                  },
                  {
                    "type": "Action",
                    "module": "math",
                    "args": {
                      "__options": [
                        "add"
                      ],
                      "op": "add",
                      "a": "missingVar",
                      "b": 1
                    },
                    "output": "broken"
                  }
                ]
              }
            },
            {
              "type": "Action",
              "module": "math",
              "args": {
                "__options": [
                  "add"
                ],
                "op": "add",
                "a": "retryCounter",
                "b": 10
              },
              "output": "ok"
            },
            {
              "type": "Return",
              "entries": [
                {
                  "key": "attempts",
                  "expression": {
                    "type": "Identifier",
                    "name": "retryCounter"
                  }
                },
                {
                  "key": "result",
                  "expression": {
                    "type": "Identifier",
                    "name": "ok"
                  }
                }
              ]
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "jumpExample",
        "desc": "Jump policy",
        "onError": "jump='recovery'",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Jump example start"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_6"
            },
            {
              "type": "Action",
              "module": "math",
              "args": {
                "__options": [
                  "add"
                ],
                "op": "add",
                "a": "missingVar",
                "b": 1
              },
              "output": "broken"
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "recovery",
        "desc": "Jump target",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "Running recovery step"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_7"
            },
            {
              "type": "Return",
              "entries": [
                {
                  "key": "message",
                  "expression": {
                    "type": "Literal",
                    "value": "Jump handled"
                  }
                }
              ]
            }
          ]
        }
      },
      {
        "type": "Step",
        "id": "summary",
        "desc": "Summary",
        "block": {
          "type": "Block",
          "statements": [
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "retry result:"
                    }
                  },
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Identifier",
                      "name": "retryExample"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_8"
            },
            {
              "type": "Action",
              "module": "print",
              "args": {
                "__entries": [
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Literal",
                      "value": "recovery result:"
                    }
                  },
                  {
                    "kind": "expression",
                    "value": {
                      "type": "Identifier",
                      "name": "recovery"
                    }
                  }
                ],
                "__suppressStore": true
              },
              "output": "__print_dummy_9"
            }
          ]
        }
      }
    ]
  }
}